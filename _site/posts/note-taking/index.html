<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-07-23">

<title>How I Take Notes – Home</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Home</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../resume.pdf"> 
<span class="menu-text">Résumé</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rileywheadon"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">How I Take Notes</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Obsidian</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 23, 2024</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">October 29, 2024</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>Every day I get bombarded with more information than I can possibly remember. From lectures to videos to random blog posts I stumble across in my spare time, I estimate that my brain alone can recall maybe 10% of what I consume. Before I started my knowledge management journey, the other 90% would slip away, only to frustrate me later. “I’m pretty sure I learned how to do XYZ before, but I forgot and now I have to Google it” was an all-too-common experience. This bothered me because I hate doing things twice. To keep track of everything I’d learned, I started taking a lot of notes. However, this quickly became messy, so I began developing a way to stay organized–a <em>knowledge management system</em>. After a year of effort, this system has grown to hundreds of notes and improved my productivity significantly.</p>
<p>In this post, I will outline exactly <em>how</em> and <em>why</em> I take notes. Obviously, what I do is tailored to my interests and needs, and it may not work for everyone. At the very least, I hope reading this gives you ideas and motivation for developing your own knowledge management system.</p>
<p><strong>Philosophy</strong></p>
<p>As I mentioned previously, my goal is to never have to relearn a piece of information. Every time I learn a mathematical theorem or software library, I create a brief note and jot down any important details. The information that goes into my system comes from a variety of sources, including lectures, books, blogs, podcasts, and videos. You might think that taking notes on a blog is overkill, but hear me out. Taking notes forces you to not just understand the media you’re consuming, but also summarize it.</p>
<p>According to Bloom’s taxonomy (<a href="https://www.valamis.com/hub/blooms-taxonomy">source</a>), taking notes moves you from remember/understand to at least apply. If you’re being thorough, note-taking helps you deeply analyze what you’re reading and find connections with other ideas. Yes, taking notes on a piece of media probably takes 2-3 times longer than just reading it. But this is a trade-off I’m willing to make. I’d rather read one book, learn it well, and have a list of ideas to revisit later than read three books haphazardly in the same time. If I learn something useful, I write it down. It’s as simple as that.</p>
<p>When actually taking notes, I live by the rule <em>one idea, one note</em> principle. In practice, this means I don’t make a note for each piece of media I consume. Instead, I add ideas from what I’m currently reading to related notes I already have. Note length isn’t important to me. Some ideas require a lot of justification or context, while others can be as short as 2-3 sentences. I do not create separate notes for examples or practice problems. Instead, I include them under an <code>Examples</code> or <code>Exercises</code> header within an existing note. I believe that if a note really represents one idea, its title should be short. If I can’t think of a concise title for a note, the note probably shouldn’t exist.</p>
<p><strong>Obsidian</strong></p>
<p>I’ve found digital note-taking with <a href="https://obsidian.md/">Obsidian</a> to be the most effective platform for my system. I’m not going to explain how Obsidian works (there’s an excellent tutorial <a href="https://help.obsidian.md/Home">here</a>), but I will outline why I use it. First, Obsidian has an extremely low barrier to entry while also being highly customizable and extensible. The plugin ecosystem for Obsidian is unmatched; it has solutions for every conceivable use case and more. Another advantage of Obsidian is that notes are stored as <a href="https://en.wikipedia.org/wiki/Markdown">Markdown</a> files, so your notes will remain accessible even if Obsidian were to be deprecated. Since notes are stored locally, Obsidian gives you complete autonomy over your data, unlike cloud-based software such as <a href="https://www.notion.so/">Notion</a> and Google Drive. Finally, Obsidian lets me edit my notes using <a href="https://publish.obsidian.md/hub/04+-+Guides%2C+Workflows%2C+%26+Courses/for+Vim+users">vim-like</a> key bindings, which makes editing text <em>so</em> much faster. Everyone who spends a lot of time on their computer should learn vim, it’s legitimately life-changing.</p>
<p><strong>File Structure</strong></p>
<p>The layout of my Obsidian vault is roughly based on the <a href="https://johnnydecimal.com/">Johnny Decimal</a> system. I like this philosophy for arranging my folders because it places a hard limit on the amount of depth in my file tree. Why is depth bad? When you create a new file in Obsidian, it gets placed in the same folder as the file you currently have open. To avoid moving files around manually, it therefore makes sense to keep your file tree as shallow as possible. Additionally, the breadth of your file tree is no issue since Obsidian allows you to search your entire vault at once. You <em>could</em> put every single note and image into the root of your vault and Obsidian would work just fine. The issues start when you need to get all the files related to a certain topic. Then, <a href="https://help.obsidian.md/Editing+and+formatting/Tags">tags</a> or folders are necessary. In conclusion, I would recommend setting up your vault to use as few folders as possible while still maintaining some semblance of structure.</p>
<p>Since my entire vault contains hundreds of notes, it can help to create maps of content (MOCs), which are notes whose sole purpose is to link to many other notes. I like to prefix my MOCs with the star (⭐️) emoji, which conveniently moves them to the top of the file explorer in the sidebar. If I need nested MOCs, I’ll prefix the second layer with the home (🏠) emoji, which places these notes just beneath the starred notes in the file explorer. For an example of what my file structure looks like in practice, here’s a snapshot of my “University” folder:</p>
<pre><code>/30 University
    /31 UBC
        Schedule.md
        Course Planning.md
        Todo.md
    /32 MATH 320
        /32.01 Notes
            ⭐️ MATH 320.md
            Least Upper Bound.md
            ...
        /32.02 Resources
            math-320-textbook.pdf
        /32.03 Assignment 1
            main.tex
            ...
            main.pdf
    /33 MATH 361
    ...</code></pre>
<p><strong>The Fuzzy Finder</strong></p>
<p>The <strong>Fuzzy Finder</strong> is Obsidian’s mechanism for searching a vault, which locates notes by folder and title <em>simultaneously</em>. Then, by pressing <code>CMD + ENTER</code>, I can effortlessly open the top search result in a new tab. This is extremely useful because it allows me to create, delete, and switch between notes without having to open a file explorer. Because the fuzzy finder displays the file path, it’s possible to differentiate notes by both their title <em>and</em> their location. Consider the following file tree:</p>
<pre><code>/MATH-100
    formula-sheet
/PHYS-131
    formula-sheet</code></pre>
<p>If I search for <code>MATH 100 formula sheet</code>, the fuzzy finder will only index the file in the MATH 100 folder, which allows me to have many notes with the same title across my vault.</p>
<section id="plugins-and-extensions" class="level2">
<h2 class="anchored" data-anchor-id="plugins-and-extensions">Plugins and Extensions</h2>
<p><strong>LaTeX Suite</strong></p>
<p>The <a href="https://github.com/artisticat1/obsidian-latex-suite">Obsidian LaTeX Suite</a> allows me to rapidly typeset <span class="math inline">\(\LaTeX\)</span> using a set of customizable snippets. I’m not going to elaborate on this plugin’s functionality since I wrote a separate guide on it <a href="../../posts/fast-typesetting/index.html">here</a>.</p>
<p><strong>Advanced Tables</strong></p>
<p>Obsidian allows you to edit text in two ways–live preview and source mode. Since I type a lot of <span class="math inline">\(\LaTeX\)</span> in my notes, I prefer using source mode in order to see exactly what I’m typing. Unfortunately, this means I can’t use the new <a href="https://obsidian.md/changelog/2023-12-26-desktop-v1.5.3/">Table Editor</a>, which only works in live preview mode. To get around this problem, I use the <a href="https://github.com/tgrosinger/advanced-tables-obsidian">Advanced Tables</a> plugin, which gives me the functionality I need in source mode. Particularly, I am able to:</p>
<ul>
<li>Use <code>TAB</code> to cycle through cells.</li>
<li>Bind hotkeys to insert and delete both rows and columns.</li>
<li>Automatically align table border characters.</li>
<li>Add basic Excel-like formulas to my tables.</li>
</ul>
<p>This plugin only works in source mode, so if you use live preview, I would just stick to the built-in table editor.</p>
<p><strong>Citations</strong></p>
<p>I’ve doing research since May, and this means dealing with <em>a lot</em> of sources. I began using <a href="https://www.zotero.org/">Zotero</a> to keep track of my references, but I wanted to have access to them within my Obsidian vault. The way I added this functionality was with the <a href="https://github.com/hans/obsidian-citation-plugin">Citations</a> plugin, which automatically imports sources from a Zotero folder. Note that the <a href="https://retorque.re/zotero-better-bibtex/">Better BibTeX</a> Zotero extension is required for this to work. The Citations plugin also allows me to create “literature notes” containing relevant metadata from any reference in my Zotero folder.</p>
<p><em>Update</em> (10/29/24): I am now using the <a href="https://github.com/mgmeyers/obsidian-zotero-integration">Zotero Integration</a> plugin, although Citations is perfectly fine as well.</p>
<p><strong>Excalidraw</strong></p>
<p>I do not own a drawing tablet, so it’s nice to have a way to create quick, informal diagrams. I’ve found the <a href="https://github.com/zsviczian/obsidian-excalidraw-plugin">Excalidraw</a> plugin to work great for this use case. My favourite feature of this plugin is the ability to seamlessly import drawings into my notes without having to worry about exporting images from another piece of software.</p>
<p><strong>Linter</strong></p>
<p>The <a href="https://github.com/platers/obsidian-linter">Obsidian Linter</a> plugin ensures that the markdown files within your vault are formatted consistently. It can do things like add a line break above and below lists, automatically capitalize headings, and remove consecutive empty lines. This normally wouldn’t matter to me but Pandoc (see below) can get picky about markdown syntax.</p>
<p><strong>Pandoc</strong></p>
<p>The <a href="https://pandoc.org/">Pandoc</a> CLI application has grown to be an <em>extremely</em> important part of my workflow. It allows me to export markdown files from my Obsidian vault to almost any other file type. I find this to be particularly useful when typesetting mathematics since the document formatting syntax in <span class="math inline">\(\LaTeX\)</span> is just awful. I’ve used Pandoc to produce research reports, assignments, and presentations using <a href="https://www.overleaf.com/learn/latex/Beamer">Beamer</a>. Of course, Pandoc trades control over document formatting for writing speed. Personally, this is a sacrifice I’m willing to make. But if you need to create professional documents, exporting markdown files via Pandoc probably won’t provide enough capabilities.</p>
<p><em>Update</em> (10/29/24): Exporting markdown files to PDF proved to be too cumbersome, so I am back to using <span class="math inline">\(\LaTeX\)</span> for more formal writing.</p>
<p><strong>Quartz</strong></p>
<p><a href="https://quartz.jzhao.xyz/">Quartz</a> is the incredible software I use to turn my Obsidian vault into a “mini-blog”. It seamlessly converts Obsidian-style markdown files to webpages and makes it easy to add links and attachments. My website doesn’t have all the features of a real blog, like comments and feeds. But I can quickly push new posts and easily control the layout and style of my website, which is all I need for now. If you’re interested in publishing your writing quickly and easily, I would recommend giving Quartz a try. It’s even simpler than other lightweight blogging software like <a href="https://jekyllrb.com/">Jekyll</a>.</p>
<p><em>Update</em> (08/01/2024): I’ve decided to give <a href="https://obsidian.md/publish">Obsidian Publish</a> a try, and I’ve found it to be even more straightforward than Quartz. However, Obsidian Publish does require subscription ($8 USD/month or $4.80 USD/month with the student discount).</p>
<p><em>Update</em> (10/19/2024): I’ve moved the blog over to <a href="https://quarto.org/">Quarto</a> to improve support for code snippets.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>My Obsidian vault has grown to be more than just a note-taking system. I now use it to make to-do lists, create schedules, journal, and, of course, take notes. Using plugins and external software, I’ve extended my Obsidian vault to the point where it’s the only software I need to produce documents of all kinds. By developing an efficient system for note-taking, I’ve made it easier to process the enormous amount of information I’m exposed to every day. This has helped me learn faster, write better, and study more effectively. If you’re interested in trying something similar, the best time to start is now. All you need to do is start writing.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/rwheadon\.dev");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>